www.{$PUBLIC_DOMAIN} {
  redir https://{$PUBLIC_DOMAIN}{uri} permanent
}

ollama-ui.{$PUBLIC_DOMAIN} {
  reverse_proxy http://open-webui:8080
}

{$PUBLIC_DOMAIN} {
  encode zstd gzip

  @health path /health
  handle @health {
    reverse_proxy http://backend:8080
  }

  @kuma path /kuma /kuma/*
  handle @kuma {
    uri strip_prefix /kuma
    reverse_proxy http://uptime-kuma:3001 {
      header_up X-Forwarded-Prefix /kuma
      header_down Location ^/(.*)$ /kuma/$1
      header_down Set-Cookie (.*)Path=/;?(.*) $1Path=/kuma;$2
    }
  }

  @ollama path /ollama /ollama/*
  handle @ollama {
    uri strip_prefix /ollama
    reverse_proxy http://ollama:11434
  }

  @api path /api/*
  handle @api {
    reverse_proxy http://backend:8080
  }

  handle {
    reverse_proxy http://frontend:80
  }
}
